# rustdx

[<img alt="github" src="https://img.shields.io/github/license/zjp-CN/rustdx?color=blue" height="20">](https://github.com/zjp-CN/rustdx)
[<img alt="github" src="https://img.shields.io/github/issues/zjp-CN/rustdx?color=db2043" height="20">](https://github.com/zjp-CN/rustdx/issues)
[<img alt="crates.io" src="https://img.shields.io/crates/v/rustdx-complete?style=flat&color=fc8d62&logo=rust&label=rustdx-complete" height="20">](https://crates.io/crates/rustdx-complete)
[<img alt="crates.io" src="https://img.shields.io/crates/v/rustdx-complete/0.6.2?style=flat&color=green&logo=rust&logoColor=white&label=v0.6.2" height="20">](https://crates.io/crates/rustdx-complete)
[<img alt="docs.rs" src="https://img.shields.io/badge/docs.rs-rustdx-66c2a5?style=flat&labelColor=555555&logoColor=white&logo=data:image/svg+xml;base64,PHN2ZyByb2xlPSJpbWciIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDUxMiA1MTIiPjxwYXRoIGZpbGw9IiNmNWY1ZjUiIGQ9Ik00ODguNiAyNTAuMkwzOTIgMjE0VjEwNS41YzAtMTUtOS4zLTI4LjQtMjMuNC0zMy43bC0xMDAtMzcuNWMtOC4xLTMuMS0xNy4xLTMuMS0yNS4zIDBsLTEwMCAzNy41Yy0xNC4xIDUuMy0yMy40IDE4LjctMjMuNCAzMy43VjIxNGwtOTYuNiAzNi4yQzkuMyAyNTUuNSAwIDI2OC45IDAgMjgzLjlWMzk0YzAgMTMuNiA3LjcgMjYuMSAxOS45IDMyLjJsMTAwIDUwYzEwLjEgNS4xIDIyLjEgNS4xIDMyLjIgMGwxMDMuOS01MiAxMDMuOSA1MmMxMC4xIDUuMSAyMi4xIDUuMSAzMi4yIDBsMTAwLTUwYzEyLjItNi4xIDE5LjktMTguNiAxOS45LTMyLjJWMjgzLjljMC0xNS05LjMtMjguNC0yMy40LTMzLjd6TTM1OCAyMTQuOGwtODUgMzEuOXYtNjguMmw4NS0zN3Y3My4zek0xNTQgMTA0LjFsMTAyLTM4LjIgMTAyIDM4LjJ2LjZsLTEwMiA0MS40LTEwMi00MS40di0uNnptODQgMjkxLjFsLTg1IDQyLjV2LTc5LjFsODUtMzguOHY3NS40em0wLTExMmwtMTAyIDQxLjQtMTAyLTQxLjR2LS42bDEwMi0zOC4yIDEwMiAzOC4ydi42em0yNDAgMTEybC04NSA0Mi41di03OS4xbDg1LTM4Ljh2NzUuNHptMC0xMTJsLTEwMiA0MS40LTEwMi00MS40di0uNmwxMDItMzguMiAxMDIgMzguMnYuNnoiPjwvcGF0aD48L3N2Zz4K" height="20">](https://docs.rs/rustdx)
[<img alt="crates.io" src="https://img.shields.io/crates/v/rustdx-cmd?style=flat&color=fc8d62&logo=rust&label=rustdx-cmd" height="20">](https://crates.io/crates/rustdx-cmd)
[<img alt="build status" src="https://github.com/zjp-CN/rustdx/workflows/Release%20CI/badge.svg" height="20">](https://github.com/zjp-CN/rustdx/actions)

[![](https://img.shields.io/crates/d/rustdx.svg?label=downloads+rustdx&style=social)](https://crates.io/crates/rustdx)
[![](https://img.shields.io/crates/dv/rustdx.svg?label=downloads@latest+rustdx&style=social)](https://crates.io/crates/rustdx)
[![](https://img.shields.io/crates/d/rustdx-cmd.svg?label=downloads+rustdx-cmd&style=social)](https://crates.io/crates/rustdx-cmd)
[![](https://img.shields.io/crates/dv/rustdx-cmd.svg?label=downloads@latest+rustdx-cmd&style=social)](https://crates.io/crates/rustdx-cmd)

å— [pytdx](https://pypi.org/project/pytdx/1.28) å¯å‘çš„ A è‚¡æ•°æ®è·å–å·¥å…·ï¼ŒåŒ…å«ï¼š
1. ä¸€ä¸ª Rust é€šç”¨åº“ [rustdx-complete](https://crates.io/crates/rustdx-complete)ï¼›
2. ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…· [rustdx-cmd](https://crates.io/crates/rustdx-cmd)ã€‚

## ğŸ“ æœ€æ–°æ›´æ–° (v0.6.4 - 2025-12-31)

> **é‡è¦åŠŸèƒ½æ›´æ–°**: è¡¥å……å®Œæ•´äº”æ¡£ä¹°å–ç›˜æ•°æ®ï¼Œå®Œå…¨å¯¹æ ‡é€šè¾¾ä¿¡å®æ—¶è¡Œæƒ…åè®® âœ…

### ğŸ‰ v0.6.4 é‡è¦æ›´æ–°

**è¡¥å…… SecurityQuotes å®Œæ•´äº”æ¡£ä¹°å–ç›˜å­—æ®µ**
- âœ… æ–°å¢ bid2-5, ask2-5ï¼ˆä¹°äºŒåˆ°ä¹°äº”ã€å–äºŒåˆ°å–äº”ä»·æ ¼ï¼‰
- âœ… æ–°å¢ bid2_vol-5_vol, ask2_vol-5_volï¼ˆä¹°äºŒåˆ°ä¹°äº”ã€å–äºŒåˆ°å–äº”æˆäº¤é‡ï¼‰
- âœ… å®Œå…¨å¯¹æ ‡é€šè¾¾ä¿¡å®æ—¶è¡Œæƒ…æ•°æ®ç»“æ„
- âœ… ä¸ pytdx çš„ get_security_quotes åŠŸèƒ½ä¸€è‡´

**æ–°å¢å­—æ®µç¤ºä¾‹**:
```rust
pub struct QuoteData {
    // ...åŸæœ‰å­—æ®µ
    pub bid1: f64,   // ä¹°ä¸€ä»·
    pub ask1: f64,   // å–ä¸€ä»·
    pub bid1_vol: f64,  // ä¹°ä¸€é‡
    pub ask1_vol: f64,  // å–ä¸€é‡
    // âœ¨ æ–°å¢äº”æ¡£ä¹°å–ç›˜ï¼ˆå…±16ä¸ªæ–°å­—æ®µï¼‰
    pub bid2: f64, pub ask2: f64, pub bid2_vol: f64, pub ask2_vol: f64,
    pub bid3: f64, pub ask3: f64, pub bid3_vol: f64, pub ask3_vol: f64,
    pub bid4: f64, pub ask4: f64, pub bid4_vol: f64, pub ask4_vol: f64,
    pub bid5: f64, pub ask5: f64, pub bid5_vol: f64, pub ask5_vol: f64,
}
```

### ğŸ“ v0.6.2 æ–‡æ¡£ä¿®å¤ï¼ˆå†å²ç‰ˆæœ¬ï¼‰

### ğŸ”§ v0.6.1 é‡è¦ä¿®å¤ï¼ˆå†å²ç‰ˆæœ¬ï¼‰

**ä¿®å¤ SecurityQuotes æ•°æ®ä¸å®Œæ•´é—®é¢˜**
- âœ… è°ƒæ•´è¾¹ç•Œæ£€æŸ¥ä» 100 å­—èŠ‚æ”¹ä¸º 70 å­—èŠ‚
- âœ… ä¿®å¤å•åªè‚¡ç¥¨è§£æå¤±è´¥çš„é—®é¢˜ï¼ˆ0/1 â†’ 1/1ï¼‰
- âœ… ä¿®å¤å¤šåªè‚¡ç¥¨æ•°æ®ä¸¢å¤±çš„é—®é¢˜ï¼ˆ3/4 â†’ 4/4ï¼‰
- âœ… æ‰€æœ‰ 14 ä¸ªç¤ºä¾‹ç¨‹åºæµ‹è¯•é€šè¿‡ï¼ˆ100%ï¼‰

**ä¿®å¤ SecurityQuotes æ•°æ®ä¸å®Œæ•´é—®é¢˜**
- âœ… è°ƒæ•´è¾¹ç•Œæ£€æŸ¥ä» 100 å­—èŠ‚æ”¹ä¸º 70 å­—èŠ‚
- âœ… ä¿®å¤å•åªè‚¡ç¥¨è§£æå¤±è´¥çš„é—®é¢˜ï¼ˆ0/1 â†’ 1/1ï¼‰
- âœ… ä¿®å¤å¤šåªè‚¡ç¥¨æ•°æ®ä¸¢å¤±çš„é—®é¢˜ï¼ˆ3/4 â†’ 4/4ï¼‰
- âœ… æ‰€æœ‰ 14 ä¸ªç¤ºä¾‹ç¨‹åºæµ‹è¯•é€šè¿‡ï¼ˆ100%ï¼‰

### ğŸ“¦ å®‰è£…

```bash
# Cargo.toml
[dependencies]
rustdx-complete = "0.6.4"
```

---

## ğŸ“ å†å²ç‰ˆæœ¬ (v0.6.0 - 2025-12-30)

**1. ä¿®å¤ä¸­æ–‡ç¼–ç æ˜¾ç¤ºé—®é¢˜**
- âœ… ä¿®å¤ GBK ç¼–ç çš„ä¸­æ–‡æ•°æ®æ˜¾ç¤ºä¸ºä¹±ç çš„é—®é¢˜
- âœ… è‚¡ç¥¨åç§°ã€æŒ‡æ•°åç§°ç­‰ä¸­æ–‡æ•°æ®ç°åœ¨èƒ½æ­£ç¡®æ˜¾ç¤º
- âœ… ä½¿ç”¨ `encoding_rs` åº“è¿›è¡Œ GBK â†’ UTF-8 ç¼–ç è½¬æ¢

**2. ä¿®å¤æœåŠ¡å™¨è¿æ¥é—®é¢˜**
- âœ… ä¼˜åŒ–æœåŠ¡å™¨ IP é¡ºåºï¼Œå°†å¯ç”¨çš„æœåŠ¡å™¨ç§»åˆ°å‰é¢
- âœ… é»˜è®¤æœåŠ¡å™¨ `115.238.56.198:7709` ç°åœ¨èƒ½æ­£å¸¸è¿”å›æ•°æ®

**3. ä¿®å¤å†…å­˜å®‰å…¨é—®é¢˜**
- âœ… ç§»é™¤æ‰€æœ‰ `unsafe` çš„ `get_unchecked` æ“ä½œ
- âœ… æ·»åŠ æ•°æ®è¾¹ç•Œæ£€æŸ¥ï¼Œé˜²æ­¢ panic
- âœ… æ‰€æœ‰è§£æå‡½æ•°ç°åœ¨éƒ½èƒ½å®‰å…¨å¤„ç†ä¸å®Œæ•´æ•°æ®

**4. ä¿®å¤ç¤ºä¾‹ä»£ç **
- âœ… æ›´æ–°æ‰€æœ‰ç¤ºä¾‹ä»£ç ä½¿ç”¨æ­£ç¡®çš„ crate åç§° `rustdx_complete`
- âœ… æ‰€æœ‰ 12 ä¸ªç¤ºä¾‹ç¨‹åºç°åœ¨éƒ½èƒ½æ­£å¸¸ç¼–è¯‘å’Œè¿è¡Œ

### ğŸ“¦ å®‰è£…

```bash
# Cargo.toml
[dependencies]
rustdx-complete = "0.6.4"
```

æˆ–ä½¿ç”¨ cargo addï¼š

```bash
cargo add rustdx-complete
```

## rustdx åº“ä½¿ç”¨

rustdx æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ A è‚¡æ•°æ®è·å–åº“ï¼Œå®Œå…¨å¯¹æ ‡ pytdx çš„æ ¸å¿ƒåŠŸèƒ½ã€‚

### åŠŸèƒ½ç‰¹æ€§

| åŠŸèƒ½ | rustdx æ¨¡å— | pytdx å¯¹åº” | è¯´æ˜ |
|------|------------|-----------|------|
| æ—¥Kçº¿ | `Kline` | `get_security_bars` | æ”¯æŒå¤šç§å‘¨æœŸï¼ˆæ—¥/å‘¨/æœˆ/åˆ†é’Ÿï¼‰ |
| é™¤æƒæ•°æ® | `Xdxr` | `get_xdxr` | è‚¡ç¥¨é™¤æƒé™¤æ¯ä¿¡æ¯ |
| å®æ—¶è¡Œæƒ… | `SecurityQuotes` | `get_security_quotes` | è‚¡ç¥¨å’ŒæŒ‡æ•°å®æ—¶å¿«ç…§ |
| è‚¡ç¥¨åˆ—è¡¨ | `SecurityList` | `get_security_list` | è·å–æ‰€æœ‰è‚¡ç¥¨ä»£ç  |
| åˆ†æ—¶æ•°æ® | `MinuteTime` | `get_minute_time_data` | å½“æ—¥åˆ†æ—¶æˆäº¤æ•°æ® |
| é€ç¬”æˆäº¤ | `Transaction` | `get_transaction_data` | tick-level æˆäº¤æ•°æ® |
| è´¢åŠ¡ä¿¡æ¯ | `FinanceInfo` | `get_finance_info` | 32ä¸ªè´¢åŠ¡åŸºæœ¬é¢æ•°æ® |
| æŒ‡æ•°è¡Œæƒ… | `SecurityQuotes` | `get_index_quotes` | ä¸Šè¯æŒ‡æ•°ã€æ·±è¯æˆæŒ‡ç­‰ |

### å®‰è£…

```toml
[dependencies]
rustdx-complete = "0.6.4"
```

### ä½¿ç”¨ç¤ºä¾‹

#### è·å–è‚¡ç¥¨å®æ—¶è¡Œæƒ…

```rust
use rustdx_complete::tcp::{Tcp, Tdx};
use rustdx_complete::tcp::stock::SecurityQuotes;

fn main() -> Result<(), Box<dyn std::error::Error>> {
    let mut tcp = Tcp::new()?;

    // è·å–å¤šåªè‚¡ç¥¨çš„å®æ—¶è¡Œæƒ…
    let mut quotes = SecurityQuotes::new(vec![
        (0, "000001"),  // å¹³å®‰é“¶è¡Œï¼ˆæ·±å¸‚ï¼‰
        (1, "600000"),  // æµ¦å‘é“¶è¡Œï¼ˆæ²ªå¸‚ï¼‰
    ]);

    quotes.recv_parsed(&mut tcp)?;

    for quote in quotes.result() {
        println!("{}: å½“å‰ä»·: {}", quote.code, quote.price);
    }

    Ok(())
}
```

#### è·å–æŒ‡æ•°è¡Œæƒ…

```rust
use rustdx_complete::tcp::{Tcp, Tdx};
use rustdx_complete::tcp::stock::SecurityQuotes;

let mut tcp = Tcp::new()?;

// è·å–ä¸»è¦æŒ‡æ•°è¡Œæƒ…
let mut quotes = SecurityQuotes::new(vec![
    (1, "000001"),  // ä¸Šè¯æŒ‡æ•°
    (0, "399001"),  // æ·±è¯æˆæŒ‡
    (1, "000300"),  // æ²ªæ·±300
]);

quotes.recv_parsed(&mut tcp)?;

for quote in quotes.result() {
    println!("{}: {} (æ¶¨è·Œ: {}%)", quote.code, quote.price, quote.change_percent);
}
```

#### è·å–æ—¥çº¿æ•°æ®

```rust
use rustdx_complete::tcp::{Tcp, Tdx};
use rustdx_complete::tcp::stock::Kline;

let mut tcp = Tcp::new()?;
let mut kline = Kline::new(1, "600000", 9, 0, 10); // æ²ªå¸‚ã€æµ¦å‘é“¶è¡Œã€æ—¥çº¿ã€ä»0å¼€å§‹è·å–10æ¡

kline.recv_parsed(&mut tcp)?;

for bar in kline.result() {
    println!("{} : å¼€({}) é«˜({}) ä½({}) æ”¶({})",
        bar.dt, bar.open, bar.high, bar.low, bar.close);
}
```

#### è·å–è´¢åŠ¡ä¿¡æ¯

```rust
use rustdx_complete::tcp::{Tcp, Tdx};
use rustdx_complete::tcp::stock::FinanceInfo;

let mut tcp = Tcp::new()?;
let mut finance = FinanceInfo::new(0, "000001"); // æ·±å¸‚ã€å¹³å®‰é“¶è¡Œ

finance.recv_parsed(&mut tcp)?;

let info = &finance.result()[0];
println!("è‚¡ç¥¨ä»£ç : {}", info.code);
println!("æ€»è‚¡æœ¬: {:.0} è‚¡", info.zongguben);
println!("å‡€èµ„äº§: {:.0} å…ƒ", info.jingzichan);
println!("å‡€åˆ©æ¶¦: {:.0} å…ƒ", info.jinglirun);
```

#### è·å–åˆ†æ—¶æ•°æ®

```rust
use rustdx_complete::tcp::{Tcp, Tdx};
use rustdx_complete::tcp::stock::MinuteTime;

let mut tcp = Tcp::new()?;
let mut minute = MinuteTime::new(0, "000001"); // æ·±å¸‚ã€å¹³å®‰é“¶è¡Œ

minute.recv_parsed(&mut tcp)?;

for (i, data) in minute.result().iter().take(10).enumerate() {
    println!("{} : ä»·æ ¼={} æˆäº¤é‡={}", i + 1, data.price, data.vol);
}
```

#### è·å–é€ç¬”æˆäº¤

```rust
use rustdx_complete::tcp::{Tcp, Tdx};
use rustdx_complete::tcp::stock::Transaction;

let mut tcp = Tcp::new()?;
let mut transaction = Transaction::new(0, "000001", 0, 20); // æ·±å¸‚ã€å¹³å®‰é“¶è¡Œã€ä»ç¬¬0æ¡å¼€å§‹è·å–20ç¬”

transaction.recv_parsed(&mut tcp)?;

for data in transaction.result().iter().take(5) { // åªæ‰“å°å‰5ç¬”
    println!("{} : ä»·æ ¼={} æˆäº¤é‡={} ä¹°å–æ–¹å‘={}",
        data.time, data.price, data.vol, data.buyorsell);
}
```

### å¸‚åœºä»£ç è¯´æ˜

- `0` = æ·±å¸‚ï¼ˆæ·±åœ³è¯åˆ¸äº¤æ˜“æ‰€ï¼‰
- `1` = æ²ªå¸‚ï¼ˆä¸Šæµ·è¯åˆ¸äº¤æ˜“æ‰€ï¼‰

### è¶…æ—¶è®¾ç½®

é»˜è®¤ TCP è¶…æ—¶æ—¶é—´ä¸º 5 ç§’ã€‚å¦‚æœç½‘ç»œç¯å¢ƒè¾ƒå·®ï¼Œå¯ä»¥è°ƒæ•´ `src/tcp/mod.rs` ä¸­çš„ `TIMEOUT` å¸¸é‡ã€‚

### å®Œæ•´ç¤ºä¾‹ç¨‹åº

é¡¹ç›® `examples/` ç›®å½•ä¸‹æä¾›äº†å®Œæ•´çš„ä½¿ç”¨ç¤ºä¾‹ï¼š

- `test_security_quotes.rs` - è‚¡ç¥¨å’ŒæŒ‡æ•°è¡Œæƒ…
- `test_kline.rs` - Kçº¿æ•°æ®
- `test_finance_info.rs` - è´¢åŠ¡ä¿¡æ¯
- `test_minute_time.rs` - åˆ†æ—¶æ•°æ®
- `test_transaction.rs` - é€ç¬”æˆäº¤
- `test_security_list.rs` - è‚¡ç¥¨åˆ—è¡¨

è¿è¡Œç¤ºä¾‹ï¼š
```bash
cargo run --example test_security_quotes
```

### å¿«é€Ÿå¼€å§‹

#### 1. åˆ›å»ºæ–°é¡¹ç›®

```bash
cargo new my_stock_app
cd my_stock_app
```

#### 2. æ·»åŠ ä¾èµ–

åœ¨ `Cargo.toml` ä¸­æ·»åŠ ï¼š

```toml
[dependencies]
rustdx-complete = "0.6.4"
```

æˆ–ä½¿ç”¨ cargo addï¼š

```bash
cargo add rustdx-complete
```

#### 3. ç¼–å†™ä»£ç 

åœ¨ `src/main.rs` ä¸­ï¼š

```rust
use rustdx_complete::tcp::{Tcp, Tdx};
use rustdx_complete::tcp::stock::SecurityQuotes;

fn main() -> Result<(), Box<dyn std::error::Error>> {
    // è¿æ¥åˆ°é€šè¾¾ä¿¡æœåŠ¡å™¨
    let mut tcp = Tcp::new()?;

    // è·å–è‚¡ç¥¨è¡Œæƒ…
    let mut quotes = SecurityQuotes::new(vec![
        (0, "000001"),  // å¹³å®‰é“¶è¡Œ
        (1, "600000"),  // æµ¦å‘é“¶è¡Œ
    ]);

    quotes.recv_parsed(&mut tcp)?;

    // æ‰“å°ç»“æœ
    for quote in quotes.result() {
        println!(
            "{}: å½“å‰ä»·={}, æ¶¨è·Œå¹…={}%",
            quote.code, quote.price, quote.change_percent
        );
    }

    Ok(())
}
```

#### 4. è¿è¡Œ

```bash
cargo run
```

### API æ–‡æ¡£

å®Œæ•´çš„ API æ–‡æ¡£è¯·è®¿é—®ï¼š
- **docs.rs**: https://docs.rs/rustdx-complete
- **crates.io**: https://crates.io/crates/rustdx-complete

### è¯¦ç»†ä½¿ç”¨ç¤ºä¾‹

#### è‚¡ç¥¨å®æ—¶è¡Œæƒ…

è·å–å¤šåªè‚¡ç¥¨çš„å®æ—¶å¿«ç…§æ•°æ®ï¼š

```rust
use rustdx_complete::tcp::{Tcp, Tdx};
use rustdx_complete::tcp::stock::SecurityQuotes;

let mut tcp = Tcp::new()?;
let mut quotes = SecurityQuotes::new(vec![
    (0, "000001"),  // å¹³å®‰é“¶è¡Œï¼ˆæ·±å¸‚ï¼‰
    (1, "600000"),  // æµ¦å‘é“¶è¡Œï¼ˆæ²ªå¸‚ï¼‰
    (1, "600036"),  // æ‹›å•†é“¶è¡Œï¼ˆæ²ªå¸‚ï¼‰
]);

quotes.recv_parsed(&mut tcp)?;

for quote in quotes.result() {
    println!("è‚¡ç¥¨ä»£ç : {}", quote.code);
    println!("å½“å‰ä»·: {:.2}", quote.price);
    println!("æ˜¨æ”¶: {:.2}", quote.preclose);
    println!("ä»Šå¼€: {:.2}", quote.open);
    println!("æœ€é«˜: {:.2}", quote.high);
    println!("æœ€ä½: {:.2}", quote.low);
    println!("æˆäº¤é‡: {:.0}", quote.vol);
    println!("æˆäº¤é¢: {:.0}", quote.amount);
    println!("ä¹°ä¸€: {:.2} Ã— {:.0}", quote.bid1, quote.bid1_vol);
    println!("å–ä¸€: {:.2} Ã— {:.0}", quote.ask1, quote.ask1_vol);
    println!("ä¹°äºŒ: {:.2} Ã— {:.0}", quote.bid2, quote.bid2_vol);
    println!("å–äºŒ: {:.2} Ã— {:.0}", quote.ask2, quote.ask2_vol);
    println!("ä¹°ä¸‰: {:.2} Ã— {:.0}", quote.bid3, quote.bid3_vol);
    println!("å–ä¸‰: {:.2} Ã— {:.0}", quote.ask3, quote.ask3_vol);
    println!("ä¹°å››: {:.2} Ã— {:.0}", quote.bid4, quote.bid4_vol);
    println!("å–å››: {:.2} Ã— {:.0}", quote.ask4, quote.ask4_vol);
    println!("ä¹°äº”: {:.2} Ã— {:.0}", quote.bid5, quote.bid5_vol);
    println!("å–äº”: {:.2} Ã— {:.0}", quote.ask5, quote.ask5_vol);
    println!("æ¶¨è·Œå¹…: {:.2}%", quote.change_percent);
    println!();
}
```

**æ³¨æ„äº‹é¡¹**ï¼š
- å»ºè®®ä¸€æ¬¡æŸ¥è¯¢ä¸è¶…è¿‡ 80 åªè‚¡ç¥¨
- å¸‚åœºä»£ç ï¼š0=æ·±å¸‚ï¼Œ1=æ²ªå¸‚
- æ•°æ®ä¸ºå®æ—¶å¿«ç…§ï¼ŒåŒ…æ‹¬äº”æ¡£ä¹°å–ç›˜

#### æŒ‡æ•°è¡Œæƒ…

è·å–ä¸»è¦æŒ‡æ•°çš„å®æ—¶è¡Œæƒ…ï¼š

```rust
use rustdx_complete::tcp::{Tcp, Tdx};
use rustdx_complete::tcp::stock::SecurityQuotes;

let mut tcp = Tcp::new()?;

// è·å–ä¸»è¦æŒ‡æ•°
let mut quotes = SecurityQuotes::new(vec![
    (1, "000001"),  // ä¸Šè¯æŒ‡æ•°
    (0, "399001"),  // æ·±è¯æˆæŒ‡
    (1, "000300"),  // æ²ªæ·±300
    (0, "399006"),  // åˆ›ä¸šæ¿æŒ‡
]);

quotes.recv_parsed(&mut tcp)?;

println!("ğŸ“Š ä¸»è¦æŒ‡æ•°è¡Œæƒ…ï¼š");
for quote in quotes.result() {
    println!(
        "{}: {:.2} ({:+.2}%)",
        quote.code, quote.price, quote.change_percent
    );
}
```

**å¸¸ç”¨æŒ‡æ•°ä»£ç **ï¼š
- ä¸Šè¯æŒ‡æ•°ï¼š`000001` (market=1)
- æ·±è¯æˆæŒ‡ï¼š`399001` (market=0)
- æ²ªæ·±300ï¼š`000300` (market=1)
- åˆ›ä¸šæ¿æŒ‡ï¼š`399006` (market=0)
- ä¸­è¯500ï¼š`000905` (market=1)
- ç§‘åˆ›50ï¼š`000688` (market=1)

#### Kçº¿æ•°æ®

è·å–æ—¥Kçº¿ã€å‘¨Kçº¿ã€æœˆKçº¿ç­‰ï¼š

```rust
use rustdx_complete::tcp::{Tcp, Tdx};
use rustdx_complete::tcp::stock::Kline;

let mut tcp = Tcp::new()?;

// Klineå‚æ•°ï¼šmarket, code, category, start, count
// category: 9=æ—¥K(æ–°)
let mut kline = Kline::new(1, "600000", 9, 0, 10);  // æ²ªå¸‚ã€æµ¦å‘é“¶è¡Œã€æ—¥çº¿ã€ä»0å¼€å§‹è·å–10æ¡

kline.recv_parsed(&mut tcp)?;

println!("æµ¦å‘é“¶è¡Œæœ€è¿‘10æ—¥Kçº¿ï¼š");
for bar in kline.result() {
    println!(
        "{:?}: å¼€={:.2} é«˜={:.2} ä½={:.2} æ”¶={:.2} é‡={:.0}",
        bar.dt, bar.open, bar.high, bar.low, bar.close, bar.vol
    );
}
```

**Kçº¿å‘¨æœŸè¯´æ˜**ï¼š
- `category = 9`: æ—¥Kçº¿ï¼ˆæ¨èï¼‰
- `category = 5`: 5åˆ†é’ŸKçº¿
- `category = 6`: 15åˆ†é’ŸKçº¿
- `category = 7`: 30åˆ†é’ŸKçº¿
- `category = 8`: 1å°æ—¶Kçº¿
- `category = 10`: å‘¨Kçº¿
- `category = 11`: æœˆKçº¿

#### è´¢åŠ¡ä¿¡æ¯

è·å–è‚¡ç¥¨çš„è´¢åŠ¡åŸºæœ¬é¢æ•°æ®ï¼š

```rust
use rustdx_complete::tcp::{Tcp, Tdx};
use rustdx_complete::tcp::stock::FinanceInfo;

let mut tcp = Tcp::new()?;
let mut finance = FinanceInfo::new(0, "000001");  // å¹³å®‰é“¶è¡Œ

finance.recv_parsed(&mut tcp)?;

let info = &finance.result()[0];

println!("ğŸ“Š {} è´¢åŠ¡æ•°æ®ï¼š", info.code);
println!("ä¸Šå¸‚æ—¥æœŸ: {}", info.ipo_date);
println!("æ€»è‚¡æœ¬: {:.0} è‚¡ ({:.2} äº¿è‚¡)", info.zongguben, info.zongguben / 1_0000_0000.0);
println!("æµé€šè‚¡: {:.0} è‚¡ ({:.2} äº¿è‚¡)", info.liutongguben, info.liutongguben / 1_0000_0000.0);
println!("æ€»èµ„äº§: {:.2} äº¿å…ƒ", info.zongzichan / 1_0000_0000.0);
println!("å‡€èµ„äº§: {:.2} äº¿å…ƒ", info.jingzichan / 1_0000_0000.0);
println!("å‡€åˆ©æ¶¦: {:.2} äº¿å…ƒ", info.jinglirun / 1_0000_0000.0);
println!("ä¸»è¥æ”¶å…¥: {:.2} äº¿å…ƒ", info.zhuyingshouru / 1_0000_0000.0);
```

**è´¢åŠ¡å­—æ®µè¯´æ˜**ï¼š
- `zongguben`: æ€»è‚¡æœ¬ï¼ˆè‚¡ï¼‰
- `liutongguben`: æµé€šè‚¡æœ¬ï¼ˆè‚¡ï¼‰
- `zongzichan`: æ€»èµ„äº§ï¼ˆå…ƒï¼‰
- `jingzichan`: å‡€èµ„äº§ï¼ˆå…ƒï¼‰
- `jinglirun`: å‡€åˆ©æ¶¦ï¼ˆå…ƒï¼‰
- `zhuyingshouru`: ä¸»è¥æ”¶å…¥ï¼ˆå…ƒï¼‰
- `jingyingxianjinliu`: ç»è¥ç°é‡‘æµï¼ˆå…ƒï¼‰

#### åˆ†æ—¶æ•°æ®

è·å–å½“æ—¥åˆ†æ—¶æˆäº¤æ•°æ®ï¼ˆ240ä¸ªæ•°æ®ç‚¹ï¼‰ï¼š

```rust
use rustdx_complete::tcp::{Tcp, Tdx};
use rustdx_complete::tcp::stock::MinuteTime;

let mut tcp = Tcp::new()?;
let mut minute = MinuteTime::new(0, "000001");  // å¹³å®‰é“¶è¡Œ

minute.recv_parsed(&mut tcp)?;

println!("å¹³å®‰é“¶è¡Œåˆ†æ—¶æ•°æ®ï¼ˆå‰10æ¡ï¼‰ï¼š");
for (i, data) in minute.result().iter().take(10).enumerate() {
    println!(
        "{}: ä»·æ ¼={:.2} æˆäº¤é‡={:.0}",
        i + 1, data.price, data.vol
    );
}

println!("...");
println!("æ€»è®¡: {} æ¡æ•°æ®", minute.result().len());
```

**æ•°æ®è¯´æ˜**ï¼š
- æ¯ä¸ªäº¤æ˜“æ—¥äº§ç”Ÿ 240 æ¡åˆ†æ—¶æ•°æ®
- æ—¶é—´èŒƒå›´ï¼š9:30-15:00
- æ—¶é—´æ ¼å¼ï¼šHH:MM
- æˆäº¤é‡å•ä½ï¼šæ‰‹

#### é€ç¬”æˆäº¤

è·å– tick çº§åˆ«çš„é€ç¬”æˆäº¤æ•°æ®ï¼š

```rust
use rustdx_complete::tcp::{Tcp, Tdx};
use rustdx_complete::tcp::stock::Transaction;

let mut tcp = Tcp::new()?;
let mut transaction = Transaction::new(0, "000001", 0, 20);  // ä»ç¬¬0æ¡å¼€å§‹è·å–20ç¬”

transaction.recv_parsed(&mut tcp)?;

println!("å¹³å®‰é“¶è¡Œé€ç¬”æˆäº¤ï¼ˆæœ€è¿‘5ç¬”ï¼‰ï¼š");
for data in transaction.result().iter().take(5) {
    let direction = match data.buyorsell {
        0 => "ä¹°å…¥",
        1 => "å–å‡º",
        _ => "ä¸­æ€§",
    };

    println!(
        "{}: ä»·æ ¼={:.2} æ•°é‡={:.0}æ‰‹ æ–¹å‘={}",
        data.time, data.price, data.vol, direction
    );
}

println!("...");
// å®‰å…¨åœ°è·å–æœ€åä¸€ç¬”æˆäº¤
if let Some(last) = transaction.result().last() {
    println!("æœ€æ–°æˆäº¤åºå·: {}", last.num);
}
```

**ä¹°å–æ–¹å‘è¯´æ˜**ï¼š
- `0`: ä¹°å…¥ï¼ˆä¸»åŠ¨ä¹°ï¼‰
- `1`: å–å‡ºï¼ˆä¸»åŠ¨å–ï¼‰
- `8`: ä¸­æ€§ï¼ˆæœªçŸ¥ï¼‰

#### è‚¡ç¥¨åˆ—è¡¨

è·å–æ‰€æœ‰è‚¡ç¥¨ä»£ç å’Œåç§°ï¼š

```rust
use rustdx_complete::tcp::{Tcp, Tdx};
use rustdx_complete::tcp::stock::SecurityList;

let mut tcp = Tcp::new()?;

// ç¬¬ä¸€æ¬¡è·å–ï¼šä»0å¼€å§‹ï¼Œè·å–1000åªè‚¡ç¥¨
let mut list = SecurityList::new(0, 0);  // market=0(æ·±å¸‚), start=0

list.recv_parsed(&mut tcp)?;

println!("è‚¡ç¥¨åˆ—è¡¨ï¼ˆå‰10åªï¼‰ï¼š");
for (i, stock) in list.result().iter().take(10).enumerate() {
    println!(
        "{}: ä»£ç ={}, åç§°={}",
        i + 1, stock.code, stock.name
    );
}

println!("...");
println!("æœ¬æ‰¹æ¬¡è·å–: {} åªè‚¡ç¥¨", list.result().len());
```

**åˆ†é¡µè¯´æ˜**ï¼š
- æ¯æ¬¡æœ€å¤šè·å– 1000 åªè‚¡ç¥¨
- å‚æ•°1ï¼š`market` (0=æ·±å¸‚, 1=æ²ªå¸‚)
- å‚æ•°2ï¼š`start` (0, 1000, 2000, ...) - èµ·å§‹ä½ç½®
- ç¤ºä¾‹ï¼š`SecurityList::new(0, 0)` - æ·±å¸‚ä»0å¼€å§‹è·å–
- ç¤ºä¾‹ï¼š`SecurityList::new(0, 1000)` - æ·±å¸‚ä»1000å¼€å§‹è·å–

### é”™è¯¯å¤„ç†

æ‰€æœ‰ TCP è¿æ¥å’Œæ•°æ®è·å–éƒ½å¯èƒ½å¤±è´¥ï¼Œå»ºè®®ä½¿ç”¨é”™è¯¯å¤„ç†ï¼š

```rust
use rustdx_complete::tcp::{Tcp, Tdx};
use rustdx_complete::tcp::stock::SecurityQuotes;

fn main() {
    // å°è¯•è¿æ¥
    let mut tcp = match Tcp::new() {
        Ok(tcp) => {
            println!("âœ… è¿æ¥æˆåŠŸ");
            tcp
        }
        Err(e) => {
            eprintln!("âŒ è¿æ¥å¤±è´¥: {}", e);
            // å°è¯•å…¶ä»–æœåŠ¡å™¨æˆ–é€€å‡º
            return;
        }
    };

    // è·å–æ•°æ®
    let mut quotes = SecurityQuotes::new(vec![(0, "000001")]);

    match quotes.recv_parsed(&mut tcp) {
        Ok(_) => {
            // å¤„ç†æ•°æ®
            for quote in quotes.result() {
                println!("{}: {}", quote.code, quote.price);
            }
        }
        Err(e) => {
            eprintln!("âŒ è·å–æ•°æ®å¤±è´¥: {}", e);
        }
    }
}
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å¤ç”¨ TCP è¿æ¥**
```rust
let mut tcp = Tcp::new()?;

// è·å–å¤šç§æ•°æ®
let mut quotes = SecurityQuotes::new(vec![(0, "000001")]);
quotes.recv_parsed(&mut tcp)?;

let mut kline = Kline::new(0, "000001", 9, 0, 10);
kline.recv_parsed(&mut tcp)?;
```

2. **æ‰¹é‡æŸ¥è¯¢**
```rust
// ä¸€æ¬¡æŸ¥è¯¢å¤šåªè‚¡ç¥¨ï¼Œè€Œä¸æ˜¯å¤šæ¬¡æŸ¥è¯¢å•åªè‚¡ç¥¨
let mut quotes = SecurityQuotes::new(vec![
    (0, "000001"), (0, "000002"), (0, "000003"),
    // ... æœ€å¤š80åª
]);
```

3. **ä½¿ç”¨ release æ¨¡å¼**
```bash
cargo run --release  # æ€§èƒ½æå‡æ˜æ˜¾
```

### å¸¸è§é—®é¢˜

#### Q: ä¸ºä»€ä¹ˆè¿æ¥è¶…æ—¶ï¼Ÿ
A: é»˜è®¤è¶…æ—¶æ—¶é—´ä¸º 5 ç§’ã€‚å¦‚æœç½‘ç»œç¯å¢ƒè¾ƒå·®ï¼Œå¯ä»¥ä¿®æ”¹ `src/tcp/mod.rs` ä¸­çš„ `TIMEOUT` å¸¸é‡ã€‚

#### Q: æ•°æ®æ›´æ–°é¢‘ç‡ï¼Ÿ
A: å®æ—¶è¡Œæƒ…æ•°æ®æ¥è‡ªé€šè¾¾ä¿¡æœåŠ¡å™¨ï¼Œäº¤æ˜“æ—¶é—´å†…å®æ—¶æ›´æ–°ã€‚

#### Q: æ”¯æŒæ¸¯è‚¡å’Œç¾è‚¡å—ï¼Ÿ
A: ç›®å‰ä»…æ”¯æŒ A è‚¡ï¼ˆæ²ªæ·±ä¸¤å¸‚ï¼‰ã€‚

#### Q: å¦‚ä½•è·å–å†å²æ•°æ®ï¼Ÿ
A: ä½¿ç”¨ `Kline` æ¨¡å—è·å–å†å² K çº¿æ•°æ®ï¼Œæˆ–ä½¿ç”¨ `rustdx-cmd` å·¥å…·è§£æé€šè¾¾ä¿¡æ•°æ®æ–‡ä»¶ã€‚

#### Q: æ•°æ®å‡†ç¡®å—ï¼Ÿ
A: æ•°æ®æ¥è‡ªé€šè¾¾ä¿¡å®˜æ–¹æœåŠ¡å™¨ï¼Œç»è¿‡éªŒè¯å‡†ç¡®å¯é ã€‚

### ç¤ºä¾‹ç¨‹åº

é¡¹ç›® `examples/` ç›®å½•åŒ…å«å®Œæ•´çš„ç¤ºä¾‹ç¨‹åºï¼š

| ç¤ºä¾‹ç¨‹åº | åŠŸèƒ½æè¿° |
|---------|---------|
| `test_security_quotes.rs` | è‚¡ç¥¨å’ŒæŒ‡æ•°å®æ—¶è¡Œæƒ… |
| `test_finance_info.rs` | è´¢åŠ¡ä¿¡æ¯æŸ¥è¯¢ |
| `test_transaction.rs` | é€ç¬”æˆäº¤æ•°æ® |
| `test_minute_time.rs` | åˆ†æ—¶æ•°æ® |
| `test_security_list.rs` | è‚¡ç¥¨åˆ—è¡¨ |
| `test_index_quotes.rs` | æŒ‡æ•°è¡Œæƒ… |

è¿è¡Œç¤ºä¾‹ï¼š
```bash
cargo run --example test_security_quotes
cargo run --example test_finance_info
cargo run --example test_transaction
```

### è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ã€æŠ¥å‘Šé—®é¢˜æˆ–æå‡ºå»ºè®®ï¼

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

### è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

### è‡´è°¢

- [pytdx](https://pypi.org/project/pytdx/) - Python ç‰ˆæœ¬çš„é€šè¾¾ä¿¡æ¥å£
- é€šè¾¾ä¿¡ - æä¾›æ•°æ®æœåŠ¡å™¨

---

å‘½ä»¤è¡Œå·¥å…·ï¼ˆç»Ÿè®¡æ•°æ®åŸºäºç¬”è€…çš„å•æ ¸ CPU Ubuntu ç³»ç»Ÿ release buildï¼Œä»¥å®é™…é€Ÿåº¦ä¸ºå‡†ï¼‰ï¼š
1. è§£ææ‰€æœ‰æœ€æ–°è‚¡ç¥¨åˆ—è¡¨çš„å†å² A è‚¡æ•°æ®ï¼ˆåŒ…å«å¤æƒæ•°æ®ï¼‰ä¸åˆ° 30s ï¼Œè§£æåçš„ csv å¤§å° 1G å¤šï¼›
2. å°†è§£æåçš„ csv æ•°æ®æ’å…¥åˆ° ClickHouse ï¼ˆ20sï¼Œè¡¨ 268 Mï¼‰ æˆ– MongoDB ï¼ˆ7 åˆ†é’Ÿï¼Œè¡¨è¶…è¿‡ 700 Mï¼‰ï¼›
3. ä¸œè´¢æ—¥çº¿å¢é‡æ›´æ–°ï¼ˆåŒ…æ‹¬å¤æƒï¼‰ï¼Œ2s æ›´æ–°å®Œã€‚

å…³äºå¤æƒï¼š
1. ä½¿ç”¨æ¶¨è·Œå¹…å¤æƒç®—æ³•ï¼Œæ— éœ€ä¿®æ”¹ï¼ˆé‡ç®—ï¼‰å†å²å¤æƒä¿¡æ¯ï¼›
2. åªè®¡ç®—æ”¶ç›˜ä»·å‰å¤æƒï¼Œå…¶ä»–ä»·æ ¼å¤æƒåªéœ€åŸºäºæ”¶ç›˜ä»·å’Œç›¸å¯¹ä»·æ ¼å³å¯è®¡ç®—å‡ºæ¥ï¼ˆè¿™åœ¨ ClickHouse ä¸­å¾ˆå¿«ï¼‰ã€‚

å…·ä½“æ–‡æ¡£å¾…è¡¥å……ã€‚

## rustdx-cmd

### å®‰è£…

ä½¿ç”¨ä»¥ä¸‹ä¸€ç§æ–¹å¼å³å¯ï¼š

1. ä¸‹è½½ [å·²ç¼–è¯‘çš„ release ç‰ˆæœ¬](https://github.com/zjp-CN/rustdx/releases/latest)

2. cargo installï¼š
```console
cargo install rustdx-cmd
```

3. cargo buildï¼š
```console
$ git clone https://github.com/zjp-CN/rustdx.git
$ cd rustdx
$ cargo build -p rustdx-cmd --release # ç¼–è¯‘ï¼ˆäºŒè¿›åˆ¶åœ¨ target/release ä¸‹ï¼‰
$ cargo install --path rustdx-cmd     # å®‰è£…ï¼ˆäºŒè¿›åˆ¶åœ¨å…¨å±€ .cargo/bin ä¸‹ï¼‰
```

### å­å‘½ä»¤

- dayï¼šè§£æé€šè¾¾ä¿¡ day æ–‡ä»¶ï¼Œå…·ä½“æŸ¥çœ‹å¸®åŠ© `rustdx day --help`ã€`rustdx day -h o -h l`ã€‚
- eastï¼šè·å–ä¸œæ–¹è´¢å¯Œå½“æ—¥ A è‚¡æ•°æ®ï¼Œå…·ä½“æŸ¥çœ‹å¸®åŠ© `rustdx east --help`ã€‚

### å®Œæ•´ä½¿ç”¨ä¾‹å­

å‡†å¤‡å¥½ day æ–‡ä»¶ã€gbbq æ–‡ä»¶å’Œ ClickHouse æ•°æ®åº“ï¼š

p.s. è¯·å‹¿ä½¿ç”¨æœ¬é¡¹ç›® `assets/` ä¸­çš„ gbbq æ–‡ä»¶ï¼Œå› ä¸ºé‚£å¯¹ä½ æ¥è¯´æ˜¯è¿‡æ—¶çš„ã€‚

> æ³¨æ„ï¼š
>
> æ­¤å·¥å…·çš„ä¸»è¦ç›®çš„å°±æ˜¯å¿«é€Ÿè¡¥é½å†å²æ—¥çº¿æ•°æ®ï¼Œä½†**æ²¡æœ‰**æ ¡éªŒäº¤æ˜“æ—¥æ•°æ®è¿ç»­æˆ–è€…æ¸…ç©ºæ•°æ®åº“çš„åŠŸèƒ½ã€‚
>
> å› æ²¡æœ‰æ¯å¤©è®°å½•æ—¥çº¿å¯¼è‡´æ—¥çº¿ä¸å®Œæ•´ï¼ˆæˆ–è€…å…¶ä»–åŸå› å¯¼è‡´æ•°æ®æœ‰é—®é¢˜ï¼‰ï¼Œè¯·**é‡æ–°**è§£æå’Œå­˜å‚¨æ‰€æœ‰å†å²æ•°æ®ã€‚
>
> é‡æ–°å­˜å‚¨æ•°æ®ä¹‹å‰ï¼Œä½¿ç”¨ä»¥ä¸‹ sql å‘½ä»¤ï¼ˆä»¥ ClickHouse ä¸ºä¾‹ï¼‰åˆ é™¤å†å²æ•°æ®ï¼š
>
> ```sql
> TRUNCATE TABLE rustdx.factor;
> ```
>
> å¦‚æœå‘ç°å†å²æ•°æ®ä¸æ­£ç¡®ï¼Œè¯·æäº¤ [issue](https://github.com/zjp-CN/rustdx/issues)ã€‚

```console
# è§£ææ‰€æœ‰æœ€æ–°è‚¡ç¥¨çš„å†å²æ—¥çº¿æ•°æ®ï¼Œä¸”è®¡ç®—å¤æƒæ•°æ®
$ rustdx day /vdb/tmp/tdx/sh/ /vdb/tmp/tdx/sz/ -l official -g ../assets/gbbq -t rustdx.factor
# å†™å…¥ ClickHouse æ•°æ®åº“
$ clickhouse-client --query "INSERT INTO rustdx.factor FORMAT CSVWithNames" < stocks.csv

# æœ‰äº†å†å²æ—¥çº¿æ•°æ®ä¹‹åï¼Œæ¯ä¸ªäº¤æ˜“æ—¥æ”¶ç›˜ä¹‹åï¼Œæ›´æ–°å½“å¤©æ•°æ®
$ rustdx east -p factor.csv -t rustdx.factor
# å†™å…¥ ClickHouse æ•°æ®åº“
$ clickhouse-client --query "INSERT INTO rustdx.factor FORMAT CSVWithNames" < eastmoney.csv
```

å…¶ä¸­ factor.csv æ¥è‡ªæ•°æ®åº“ä¸­ï¼Œå‰ä¸€å¤©çš„å¤æƒæ•°æ®ï¼ŒClickHouse çš„å¯¼å‡ºå‘½ä»¤ï¼š
```sql
SELECT
    yesterday() AS date,
    code,
    last_value(close) AS close,
    last_value(factor) AS factor
FROM rustdx.factor
GROUP BY code
INTO OUTFILE 'factor.csv'
FORMAT CSVWithNames;
```

---

æˆ–è€…ï¼š
```console
# è§£ææ‰€æœ‰æœ€æ–°è‚¡ç¥¨çš„å†å²æ—¥çº¿æ•°æ®ï¼Œä¸”è®¡ç®—å¤æƒæ•°æ®ï¼Œå†™å…¥ ClickHouse æ•°æ®åº“
$ rustdx day /vdb/tmp/tdx/sh/ /vdb/tmp/tdx/sz/ -l official -g ../assets/gbbq -o clickhouse -t rustdx.factor

# æœ‰äº†å†å²æ—¥çº¿æ•°æ®ä¹‹åï¼Œæ¯ä¸ªäº¤æ˜“æ—¥æ”¶ç›˜ä¹‹åï¼Œæ›´æ–°å½“å¤©æ•°æ®
$ rustdx east -p clickhouse -o clickhouse -t rustdx.factor
```

## CHANGELOG

[æ›´æ–°è®°å½•](https://github.com/zjp-CN/rustdx/blob/main/CHANGELOG.md)

## ä½¿ç”¨ç¤ºä¾‹

### è®¡ç®—ä»»ä½•å‘¨æœŸçš„æ¶¨è·Œå¹…

```sql
SELECT
    code,
    toYYYYMM(date) AS m, -- è¿™é‡Œä»¥æœˆå‘¨æœŸä¸ºä¾‹
    ((LAST_VALUE(factor) / FIRST_VALUE(factor)) * FIRST_VALUE(close)) / FIRST_VALUE(preclose) AS mgrowth
FROM rustdx.factor -- å‘½ä»¤è¡Œå‚æ•°ä¸­æ‰€å†™å…¥çš„è¡¨åï¼Œå‡è®¾ä½ æŒ‰ç…§æˆ‘ä¸Šé¢ç»™çš„å‘½ä»¤è¡Œç¤ºä¾‹è¿è¡Œï¼Œé‚£ä¹ˆåŸå§‹æ•°æ®åœ¨è¿™ä¸ªè¡¨
GROUP BY code, m   -- æŒ‰ç…§æœˆèšåˆ
ORDER BY code ASC, m DESC;
```

ä¸ºä»€ä¹ˆ `mgrowth` æ˜¯é‚£æ ·è®¡ç®—ï¼Œè§ [æ¶¨è·Œå¹…å¤æƒä¸å‰å¤æƒ](https://zjp-cn.github.io/posts/qfq/)ã€‚

### è®¡ç®—å‰å¤æƒä»·æ ¼

æ³¨æ„ï¼Œä¸Šé¢è®¡ç®—æ¶¨å¹…æ—¶æ²¡æœ‰è®¡ç®—å‰å¤æƒä»·æ ¼ï¼Œä½†å¤§éƒ¨åˆ†æƒ…å†µä¸‹å¿…é¡»çŸ¥é“å‰å¤æƒä»·æ ¼æ¥è®¡ç®—ä»·æ ¼ç›¸å…³çš„æŒ‡æ ‡ã€‚

é‚£ä¹ˆå¯ä»¥æ¯æ—¥æ•°æ®æˆåŠŸå…¥åº“ä¹‹åï¼Œè¿è¡Œä¸€æ¬¡ä»¥ä¸‹è„šæœ¬ï¼Œæ³¨æ„ï¼š
* è¿™åŸºäºæœ€æ–°ä»·æ¥è®¡ç®—æ‰€æœ‰è‚¡ç¥¨çš„æ‰€æœ‰å†å²å‰å¤æƒä»·æ ¼ï¼ˆåœ¨æˆ‘çš„å•æ ¸æœºå™¨ä¸Šéœ€è¦ 11 ç§’ï¼‰
* æ¯æ¬¡è¿è¡Œè„šæœ¬ä¼šæŠŠä¹‹å‰çš„è®¡ç®—ç»“æœæ¸…ç©º
* å‰å¤æƒçš„ç»“æœåœ¨ `rustdx.qfq` è¿™ä¸ªè¡¨ï¼ˆåªæœ‰è‚¡ç¥¨ä»£ç å’Œä»·æ ¼ï¼‰

```sql
-- è®¡ç®—å‰å¤æƒä»·æ ¼
DROP TABLE IF EXISTS rustdx.qfq_x; -- ä¸´æ—¶è¡¨
CREATE TABLE rustdx.qfq_x (
    code FixedString(6),
    x    Float64,
    PRIMARY KEY(code)
) ENGINE = MergeTree  AS 
WITH
qfq AS (
    SELECT code, LAST_VALUE(close) / LAST_VALUE(factor) AS qfq_multi
    FROM rustdx.factor
    GROUP BY code
    ORDER BY code
)
SELECT * FROM qfq;

DROP TABLE IF EXISTS rustdx.qfq; -- å‰å¤æƒä»·æ ¼
CREATE TABLE rustdx.qfq (
    date  Date,
    code  FixedString(6),
    close Float64,
    open  Float64,
    high  Float64,
    low   Float64,
    PRIMARY KEY(date, code)
) ENGINE = MergeTree AS
WITH
qfq_x AS (SELECT * FROM rustdx.qfq_x),
fct AS (
    SELECT date, code, open/close AS open, high/close AS high, low/close AS low, factor
    FROM rustdx.factor
),
raw AS (
    SELECT *
    FROM fct
    LEFT JOIN qfq_x ON qfq_x.code = fct.code
)
SELECT date, code, factor*x AS close, open*close AS open, high*close AS high, low*close AS low
FROM raw
ORDER BY date, code
```
