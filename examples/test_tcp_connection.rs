use rustdx_complete::tcp::{Tcp, Tdx};
use std::io::Result;

fn main() -> Result<()> {
    println!("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
    println!("         TCPè¿æ¥æµ‹è¯•ç¨‹åº");
    println!("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");
    
    println!("ğŸ“¡ æ­£åœ¨è¿æ¥åˆ°é€šè¾¾ä¿¡æœåŠ¡å™¨...");
    println!("   è¶…æ—¶è®¾ç½®: 5ç§’");
    println!("   æœåŠ¡å™¨: {}", rustdx::tcp::ip::STOCK_IP[0]);
    
    let mut tcp = Tcp::new()?;
    println!("âœ… è¿æ¥æˆåŠŸï¼\n");
    
    println!("ğŸ“Š æ­£åœ¨è·å–è¯åˆ¸åˆ—è¡¨...");
    let mut list = rustdx::tcp::SecurityList::new(0, 0); // æ·±å¸‚ï¼Œä»0å¼€å§‹
    let result = list.recv_parsed(&mut tcp);

    match result {
        Ok(data) => {
            println!("âœ… è·å–æˆåŠŸï¼\n");
            println!("è¿”å›æ•°æ®ç»Ÿè®¡:");
            println!("  - æ€»æ¡æ•°: {}", data.len());
            
            if data.len() > 0 {
                println!("\nå‰5æ¡è¯åˆ¸ä¿¡æ¯ï¼š");
                for (i, item) in data.iter().take(5).enumerate() {
                    println!("  {}. ä»£ç : {}, åç§°: {}", i+1, item.code, item.name);
                }
            }
        }
        Err(e) => {
            println!("âŒ è·å–å¤±è´¥: {}", e);
            return Err(e);
        }
    }
    
    println!("\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”");
    println!("         æµ‹è¯•å®Œæˆ");
    println!("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n");
    
    Ok(())
}
